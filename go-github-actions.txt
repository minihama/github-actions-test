다음은 Go 웹 애플리케이션, Nginx 리버스 프록시, Docker 및 GitHub Actions를 사용하여 CI/CD 파이프라인을 구축하는 전체 구성입니다.

## 1. Go 웹 애플리케이션 (`main.go`)

```go
package main

import (
	"fmt"
	"net/http"
)

func helloHandler(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintf(w, "Hello, World!")
}

func main() {
	http.HandleFunc("/", helloHandler)
	fmt.Println("Server starting on port 8080...")
	if err := http.ListenAndServe(":8080", nil); err != nil {
		fmt.Printf("Error starting server: %s\n", err)
	}
}
```

## 2. Go 테스트 코드 (`main_test.go`)

```go
package main

import (
	"net/http"
	"net/http/httptest"
	"testing"
)

func Test_helloHandler(t *testing.T) {
	req, err := http.NewRequest("GET", "/", nil)
	if err != nil {
		t.Fatal(err)
	}

	rr := httptest.NewRecorder()
	handler := http.HandlerFunc(helloHandler)

	handler.ServeHTTP(rr, req)

	if status := rr.Code; status != http.StatusOK {
		t.Errorf("handler returned wrong status code: got %v want %v",
			status, http.StatusOK)
	}

	expected := `Hello, World!`
	if rr.Body.String() != expected {
		t.Errorf("handler returned unexpected body: got %v want %v",
			rr.Body.String(), expected)
	}
}
```

## 3. Go 모듈 파일 (`go.mod`)

```
module github.com/minih/github-actions-test

go 1.24.5
```

## 4. Nginx 설정 파일 (`nginx.conf`)

```nginx
events {}

http {
    server {
        listen 80;

        location / {
            proxy_pass http://app:8080;
        }
    }
}
```

## 5. Dockerfile

```dockerfile
# Build stage
FROM golang:1.22-alpine AS builder

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .

RUN CGO_ENABLED=0 GOOS=linux go build -o /go-app

# Final stage
FROM alpine:latest

WORKDIR /root/

COPY --from=builder /go-app .

EXPOSE 8080

CMD ["./go-app"]
```

## 6. Docker Compose 파일 (`docker-compose.yml`)

```yaml
services:
  app:
    build: .
    container_name: go-app

  nginx:
    image: nginx:latest
    container_name: nginx-proxy
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - app
```

## 7. GitHub Actions 워크플로우 (`.github/workflows/ci.yml`)

```yaml
name: Go CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.22'

    - name: Test
      run: go test -v ./...

    - name: Build with Docker Compose
      run: docker-compose build
```

